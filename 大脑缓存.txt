审批{
    
}
{
    员工id-多对多-待办事项
    员工角色-多对多-待办事项
}
待办事项表{
    员工id 数组，
    角色 数组，
    指定人员id数组，
    指定角色和岗位的id数组，
    部门id{

    }
    //或签时怎么记录，
    已签人id数组{
        除了或签，都是只有1人
    }
}
部门表{
    部门信息，
    主管id
}
部门主管数组{
    部门一{
        部门信息，
        主管信息，
        father：{
            二级部门信息，
            主管信息，
            father:{...}
        }
    }，
    部门二{
        ...
    }
}
需求{
    1.传入当个员工id，和 角色数组，获取个人的待办事项{
        通过admin_id获取需要审批的数据{
            正则查询
        }
        通过角色获取需要审批的表单{
            需要知道当前用户所属的角色id_arr - 可以通过载入页面时获取
            角色数组正则 Or 查询
        }
    }
    2.传入单个员工id，获取待办数{
        用缓存，或是直接查询，用session暂存
        缓存{
            admin表新加缓存字段，与缓存版本字段，有新待办记录插入时，更新员工id的，角色下所有员工的缓存版本字段
        }
        直接查同上，
        session暂存{
            先直接查，然后暂存，待办数改变时要同时更新session
        }
    }
    3.传入职位id+部门id，获取待办事项{
        所在部门列表[
            部门信息
            岗位类型
        ]
    }
    4.待办事项具体内容，点击跳转到详情页{
        已走的流程，
        未走的流程，
        转交，
        流程条件{
            传入dom，//可以自己获取数据
            判断方式:{
                比大小，值区间，参考tp的where
            }
        }
        流程详细{
            发起：{
                发起人信息，
            }
            审批人：
                2.指定人员{
                    转交时才指定
                }
                3.指定角色，指定职务{ //职务也并在角色表
                    指定角色用 角色id，指定职务 {
                        但职务为主管时，保存的id为 角色id + '.' + 部门id
                    }
                    或签{
                        Operator:[
                            {
                                记录已审批，或签只有一人，
                            }
                        ]
                    }
                    合签{

                    }
                }
            提交的处理流程：{
                提交当前流程，取出下一个流程的数据，填加到数据库
            }
        }
    }
}
A:''
B:'a'
C:'a,b'
D:'a,b,c'

查D,得'a,b,c'，处理成[a,b,c],in查询

参数{
    流程json树{

    }

    样式类型,displayType{
        phone,
        computer
    }

    可以自己获取的东西{
        角色列表
        部门主管树
        当前人员信息
    }
    
}


数据结构手册
{
    type: 节点类型 supervisor,主管 branch,分支 role,角色 person,指定人员 copy,抄送人 sponsor,发起人
    type_remark: 节点说明 {
        主管时： 1,2,3,4,5...直接主管，二级主管....
        分支时：{
            '1':[
                [3, '==' ,data],        条件1 (3 == data)?
                [4, '<' ,$('')],        条件2 传入dom自动取值
            ],
            '2':[]                      空条件则默认判断通过
        }
        角色时: [id数组]
        指定人员：[人员id数组]
    }
    children: 下一级节点{
        分支时：{
            '1':{},
            '2':{}, 与分支说明对应
        },
        其他直接传下一级json
    }
    approvers: 当前节点审批人数据[
        {
           avatar: 头像,
           admin_id:
           open_id:
           name: 
        },
        ...
    ],
    approver_pass：已处理当前审批，并通过的人员列表[
        {
            avatar: 头像,
            admin_id:
            open_id:
            name: 
            time: 审批时间
        }
    ],
    approver_fail：已处理当前审批，并拒绝的人员列表[
        {
            avatar: 头像,
            admin_id:
            open_id:
            name: 
            time: 审批时间
        }
    ]
}
{
    node_type: 'copy',//节点类型
    node_name: '抄送人',//节点名字
    node_id: address.type_remark.map((str)=>{
        return 'p.'+str;
    }),//节点标记id
    node_show: true,//是否显示节点
    node_complete: false, // 节点业务是否已结束
    approvers: approvers,//显示人员列表
    approver_pass: [],
    approver_fail:[],
    approver_msg
}

完成回调中{
    获取需要的角色信息{
        最终流程中，需要获取的人员信息
        如果有转交还要中途添加
        流程刷新时把id添加进去
    }
    获取实例对象{
        有请假事由
        对象要有备注
        还需要标记已审批通过的人
    }
    渲染
}

待办事项{
    样式{
        用组件
    }
}

查询类型 年假{
    查询流程
    审批详情页要表单信息{
        “请假”对应表名
    }
    根据业务名字查询{
        中文查询
        join upcoming 查询流程{
            那，upcoming
            流程更新时，直接改变原纪录
        }
        我审批的，按业务分类{
            查“请假”
        }
        抄送我的，按业务分类{
            查“请假”
        }
    }
    从类型表查{
        但是类型表没有审批信息
        各自的表单表写具体类型
        其他表就写请假
    }
}好
添加还是覆盖
在后端更新。。

更新还是覆盖
那就更新吧
写到更新了
哦，判断表
点击跳转

整合流程详情到一个页面？
表单不同{
    获取表单的字段
    enum随意添加函数
    表单间穿插样式?{
        穿插提示字段
    }
}不行
转跳中心?
{
    传入bus_name 直接匹配网址?
    传入bus_name,upcoming_id,业务id 匹配处理函数{
        函数返回网址
    }√
    根据网址重定向，传入upcoming_id，业务id
    对应方法根据upcming_id,业务id,获取表单
}
流程结束后，判断流程成功 => 回调函数{
    修改各自关联表的状态  为成功
    执行其他操作
    控制反转{
        继承更麻烦，
    }
}判断失败 => 回调{
    修改各自关联表的状态 失败
}


查询异动申请{
    
}
时间安排{

}

流程
详情页{
    审批 和 查看{
        判断当前审批人 写成公共方法（传入 业务id）{
            那要循环判断json{
                那就判
            }
            返回 true false ，和 
        }
        判断当前审批人是不是 某人（）{
            （当前人是审批人，且，当前人是申请人的某某某）
            直接在前端页面获取直接主管？{
                直接获取主管判断，
            }
        }
    }
}
异动{
    级别异动，（无表，不需要关联id）
    部门异动，（有表）
    也就是两个回调函数
    指定职位要填写的信息{
        列表弹窗中自定义？{
            要处理包括样式，表单，传参，太复杂
        }
        限制他必须要进详情页？{
            那还需要一个限制字段
            加在json中{
                当前流程有个必选（必填）项
            }×
            直接判断{
                当前审批人的id是主管id，
                值存在各自的表单表里
            }
        }
    }
}
获取部门列表{
    获取我所在的部门列表
    获取所有部门列表
    倒数第二集
    
}
前端，前端js{

}
请假{
    年假设置{
        后台请假管理{
            导出{
                请假时间范围{
                    sql区间查询
                }
                时间线{
                    一月一行，一行有请假区间的标高亮，并注明请假时间
                }
            }
            年假设置{
                后台一键重置（今年已重置过，最后重置时的年份（字段））
                提交时，后端判断剩余天数，超出就提交失败
            }
        }
    } 2
    审批流程整理{
        封装
    } 1
    请假历史{
        列表{
            使用封装过的列表组件
        }
        时间线{
            同上
        }
    } 2
    请假详情页{
        表单展示
        审批组件{
            判断不同审批人时，显示不同表单
        }
    } 2
}
请假详情页{
    获取表单{
        通过业务id
    }
}
自己的css{
    定义html body
    qy开头
    好扩展{
        如何方便的定义新类型{
            加数字尾标？
        }
        按模块划分{
            需要折叠功能
            写注释
        }
    }
}

技能攻击{
    攻击的命中判定
    ->{
        成功命中{
            开始判断技能效果触发率
            ->{
                效果触发{
                    开始结算效果命中
                }
                效果不触发{}
            }
        }
        未命中{}
    }
}
攻击{
    判断触发率
    ->{
        效果触发{
            开始结算效果命中
        }
        效果不触发{}
    }
}
{
    抄送模板{
        收到一条抄送信息
        {{first.DATA}}
        业务名称：{{keyword1.DATA}}
        业务内容：{{keyword2.DATA}}
        业务状态：{{keyword3.DATA}}
        相关人员：{{keyword4.DATA}}
        {{remark.DATA}}
        	
    }
    申请通过/失败模板{
        审批流程提醒

    }
}